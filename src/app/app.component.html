<div class="container p-4">
  <form [formGroup]="sampleForm">
    <ng-container formArrayName="samples">
      <div
        class="sample-box bg-secondary p-2 rounded-corner"
        *ngFor="let control of sampleControls; let sampleIndex = index"
        [formGroupName]="sampleIndex"
      >
        <h1 class="text-light">Sample {{ sampleIndex + 1 }}</h1>
        <!-- row 1 -->
        <div class="row">
          <div class="form-group col-md-3">
            <label for="" class="form-label text-light">Disease</label>
            <mat-select
              type="text"
              name=""
              id=""
              class="form-control"
              formControlName="disease"
            >
              <mat-option value="1">Option 1</mat-option>
              <mat-option value="2">Option 2</mat-option>
              <mat-option value="3">Option 3</mat-option>
            </mat-select>
          </div>
          <div class="form-group col-md-3">
            <label for="" class="form-label text-light">Sample Type</label>
            <mat-select
              type="text"
              name=""
              id=""
              class="form-control"
              formControlName="sampleType"
            >
              <mat-option value="1">Option 1</mat-option>
              <mat-option value="2">Option 2</mat-option>
              <mat-option value="3">Option 3</mat-option>
            </mat-select>
          </div>
          <div class="col-md-2 align-self-end ms-auto">
            <button class="btn btn-danger" (click)="deleteSample(sampleIndex)">
              <span class="material-icons"> delete </span>
              <span> Delete Sample </span>
            </button>
          </div>
        </div>

        <!-- table row -->
        <div class="row mx-1 my-4">
          <table
            mat-table
            [dataSource]="dataSources[sampleIndex]"
            class="mat-elevation-z8"
            formArrayName="examRows"
          >
            <ng-container matColumnDef="position">
              <th mat-header-cell *matHeaderCellDef>Exam Type</th>
              <td
                mat-cell
                *matCellDef="let element; let rowIndex = index"
                [formGroupName]="rowIndex"
              >
                <mat-select
                  type="text"
                  name=""
                  id=""
                  class="form-control"
                  formControlName="examType"
                >
                  <mat-option value="1">Option 1</mat-option>
                  <mat-option value="2">Option 2</mat-option>
                  <mat-option value="3">Option 3</mat-option>
                </mat-select>
              </td>
            </ng-container>

            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Sub Exam Type</th>
              <td
                mat-cell
                *matCellDef="let element; let rowIndex = index"
                [formGroupName]="rowIndex"
              >
                <mat-select
                  type="text"
                  name=""
                  id=""
                  class="form-control"
                  formControlName="subExamType"
                >
                  <mat-option value="1">Option 1</mat-option>
                  <mat-option value="2">Option 2</mat-option>
                  <mat-option value="3">Option 3</mat-option>
                </mat-select>
              </td>
            </ng-container>

            <ng-container matColumnDef="weight">
              <th mat-header-cell *matHeaderCellDef>Weight</th>
              <td
                mat-cell
                *matCellDef="let element; let rowIndex = index"
                [formGroupName]="rowIndex"
              >
                <input
                  type="text"
                  formControlName="weight"
                  class="form-control"
                />
              </td>
            </ng-container>

            <ng-container matColumnDef="symbol">
              <th mat-header-cell *matHeaderCellDef>Symbol</th>
              <td
                mat-cell
                *matCellDef="let element; let rowIndex = index; let last = last"
              >
                <button
                  class="btn btn-sm btn-success"
                  (click)="addRow(sampleIndex)"
                  *ngIf="last"
                >
                  <span class="material-icons"> add </span>
                </button>
                <button
                  class="btn btn-sm btn-danger"
                  (click)="deleteRow(sampleIndex, rowIndex)"
                >
                  <span class="material-icons"> delete </span>
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
          </table>
        </div>

        <!-- Add Sample Row -->
        <div class="row mx-1 my-4">
          <div class="col-md-2">
            <button class="btn btn-primary" (click)="addSample()">
              <span class="material-icons"> add </span>

              <span> Add Sample </span>
            </button>
          </div>
        </div>
      </div>
    </ng-container>
  </form>
</div>
